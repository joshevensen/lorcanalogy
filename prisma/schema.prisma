// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/database.db"
}

// ============================================================================
// REFERENCE TABLES
// ============================================================================

model Ink {
  id    Int    @id @default(autoincrement())
  name  String @unique // "amber", "amethyst", "emerald", "ruby", "sapphire", "steel"

  Cards Card[]
}

model Rarity {
  id     Int    @id @default(autoincrement())
  name   String @unique

  Cards Card[]
}

model Type {
  id     Int    @id @default(autoincrement())
  name   String @unique

  Cards Card[]
}

model Classification {
  id     Int    @id @default(autoincrement())
  name   String @unique

  Cards Card[]
}

model Franchise {
  id   Int    @id @default(autoincrement())
  name String @unique

  Cards Card[]
}

model Keyword {
  id     Int    @id @default(autoincrement())
  name   String @unique

  Cards Card[]
}

model Role {
  id   Int    @id @default(autoincrement())
  name String @unique

  Cards Card[]
}

// ============================================================================
// MAIN TABLES
// ============================================================================

model Set {
  id          Int       @id
  number      Int       @unique
  name        String    @unique
  description String?
  releasedAt  DateTime

  Cards Card[]

  @@index([releasedAt])
}

model Card {
  id              Int      @id @default(autoincrement())
  setNumber       Int
  number          String
  tcgPlayerId     Int?     @unique

  image           String
  name            String
  version         String?
  text            String?
  flavorText      String?
  cost            Int
  inkable         Boolean
  lore            Int?
  strength        Int?
  willpower       Int?
  movement        Int?
  isBanned        Boolean? @default(false)

  // Relationships
  Set          Set            @relation(fields: [setId], references: [id])
  setId        Int
  Rarity       Rarity         @relation(fields: [rarityId], references: [id])
  rarityId     Int
  Type         Type           @relation(fields: [typeId], references: [id])
  typeId       Int
  Franchise    Franchise?     @relation(fields: [franchiseId], references: [id])
  franchiseId Int?
  Role         Role?          @relation(fields: [roleId], references: [id])
  roleId       Int?

  Ink            Ink[]
  Keywords       Keyword[]
  Classifications Classification[]

  @@unique([setId, number])
  @@index([setId])
  @@index([rarityId])
  @@index([typeId])
  @@index([franchiseId])
  @@index([roleId])
  @@index([setNumber])
  @@index([name])
  @@index([inkable])
  @@index([cost])
  @@index([isBanned])
}
